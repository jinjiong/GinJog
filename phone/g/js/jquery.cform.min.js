/*!
 * jQuery cForms v1.0.0
 * http://cforms.jacksbox.de
 *
 * Author: Mario Jäckle
 * eMail: support@jacksbox.de
 *
 * Copyright 2015, jacksbox.design
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */
!function(e){e.cForm=function(a){var t=this;t.$element=e(a),t.element=a,t.$element.data("cForm",t),t.init=function(){t.options=e.extend({},e.cForm.defaultOptions,t.options),t.options.templates=e.extend({},e.cForm.defaultOptions.templates,t.options.templates);var a=["input","textarea","select","button"];if(t.radioGroupArray=[],t.$element.is(a.join())){var d=t.tagName(t.$element);"input"===d&&t.handleInput(t.$element),"select"===d&&t.handleSelect(t.$element),"button"===d&&t.handleButton(t.$element),"textarea"===d&&t.handleTextarea(t.$element)}else t.$element.find("input").each(function(){t.handleInput(e(this))}),t.$element.find("select").each(function(){t.handleSelect(e(this))}),t.$element.find("button").each(function(){t.handleButton(e(this))}),t.$element.find("textarea").each(function(){t.handleTextarea(e(this))})},t.handleButton=function(e){var a=t.options.templates.button;e.wrap(a)},t.handleTextarea=function(e){var a=t.options.templates.textarea;e.wrap(a)},t.handleInput=function(a){var d=a.attr("type"),n=a.attr("name"),i=a.attr("value"),l=a.attr("checked"),c="",o=e();if("undefined"==typeof d&&d===!1)return console.log("Error: Missing type-Attribute on input!"),!1;switch("undefined"==typeof n&&n===!1&&(n=""),"undefined"==typeof i&&i===!1&&(i=""),"undefined"==typeof l&&l===!1&&(l=""),c=t.options.templates[d],d){case"password":case"text":a.wrap(c);break;case"file":o=e(c.replace("{{name}}",n)),o.bind("click",{$node:a},function(e){var a=e.data.$node;a.trigger("click")}),a.bind("change",{$html:o},function(a){var t=e(this).val().split("\\").pop(),d=a.data.$html;d.addClass("filled").find(".cform-filename").text(t)}),t.addToDom(a,o);break;case"checkbox":o=e(c.replace("{{name}}",n).replace("{{value}}",i)),(l||"checked"===l)&&o.addClass("checked").data("checked",!0),o.bind("click",{$origin:a},function(a){var t=e(this),d=a.data.$origin,n=t.data("checked");n?(d.prop("checked",!1),t.removeClass("checked").data("checked",!1)):(d.prop("checked",!0),t.addClass("checked").data("checked",!0))}),a.bind("change",{$mirror:o},function(a){var t=e(this),d=a.data.$mirror;t.prop("checked")?d.addClass("checked").data("checked",!0):d.removeClass("checked").data("checked",!1)}),t.addToDom(a,o);break;case"radio":if(t.radioGroupArray.indexOf(n)>-1)break;t.radioGroupArray.push(n);var r=e();$nodes=t.$element.find('input[type="radio"][name="'+n+'"]'),$nodes.each(function(){var a=e(this),t=a.val(),d=a.attr("checked"),i=e();i=e(c.replace("{{name}}",n).replace("{{value}}",t)),d&&i.addClass("checked").data("checked","true"),r=r.add(i),a.addClass("cform-hidden").after(i)}),r.bind("click",{$mirrors:r,$origins:$nodes},function(a){var t=e(this),d=a.data.$mirrors,n=a.data.$origins,i=t.data("value");return t.data("checked")?!0:(d.removeClass("checked").data("checked",!1),t.addClass("checked").data("checked",!0),void n.prop("checked",!0).filter('[value="'+i+'"]').prop("checked",!0))}),$nodes.bind("change",{$mirrors:r,$origins:$nodes},function(a){var t=e(this),d=a.data.$mirrors,n=(a.data.$origins,t.val());return t.data("checked")?!0:void d.removeClass("checked").data("checked",!1).filter('[data-value="'+n+'"]').data("checked",!0).addClass("checked")}),t.addToDom(a,o);break;case"submit":a.wrap(c);break;default:console.log("Error: No matching was found - You will be forever alone!")}},t.handleSelect=function(a){var d=a.attr("name"),n=a.attr("value"),i=a.attr("multiple"),l=a.find("option"),c=l.filter(":selected"),o="",r=e(),s=e();"undefined"==typeof d&&d===!1&&(d=""),"undefined"==typeof n&&n===!1&&(n=""),"undefined"==typeof i||i===!1?(i=!1,o=t.options.templates.select,s=e(o.replace("{{name}}",d).replace("{{text}}",c.html()))):(i=!0,o=t.options.templates.multiselect,s=e(o.replace("{{name}}",d))),l.each(function(){var a=e(this),d=a.prop("selected")?"selected":"",n=t.options.templates.option;n=n.replace("{{value}}",a.val()).replace("{{text}}",a.html()),r=r.add(e(n).addClass(d))}),r.bind("click",{$origin:a,$mirror:s,$options:r,multiple:i},function(a){var t=e(this),d=a.data.$origin,n=a.data.$mirror,i=a.data.$options,l=a.data.multiple,c=t.data("value"),o=t.html();if(l){var r=[];t.hasClass("selected")?(r=d.val(),r.splice(r.indexOf(c),1),d.val(r),n.data("value",r),t.removeClass("selected")):(r=d.val()?d.val():[],r.push(c),d.val(r),n.data("value",r),t.addClass("selected"))}else i.not(t).removeClass("selected"),t.addClass("selected"),d.val(c),n.data("value",c).find(".cform-control").html(o)}),a.bind("change",{$origin:a,$mirror:s,$options:r,multiple:i},function(a){var t=e(this),d=t.val(),n=t.find('option[value="'+d+'"]').html(),i=a.data.$origin,l=a.data.$mirror,c=a.data.$options,o=a.data.multiple;if(o){var r=i.val()?i.val():[],s=0;for(l.data("value",r),c.removeClass("selected"),s=0;s<r.length;s++)c.filter('[data-value="'+r[s]+'"]').addClass("selected")}else l.data("value",d).find(".cform-control").html(n),c.removeClass("selected").filter('[data-value="'+d+'"]').addClass("selected")}),s.find("ul").append(r),t.addToDom(a,s)},t.addToDom=function(e,a){e.addClass("cform-hidden").after(a)},t.tagName=function(e){return e.prop("tagName").toLowerCase()},t.init()},e.cForm.defaultOptions={templates:{text:'<div class="cform-text"></div>',textarea:'<div class="cform-text"></div>',password:'<div class="cform-text cform-password"></div>',file:'<div class="cform-file" data-name="{{name}}">    							<div class="cform-control">选择</div>    							<div class="cform-filename">文件名</div>    						</div>',checkbox:'<div class="cform-checkbox" data-name="{{name}}" data-value="{{value}}">    							<div class="cform-marker"></div>    						</div>',radio:'<div class="cform-radio" data-name="{{name}}" data-value="{{value}}">    							<div class="cform-marker"></div>    						</div>',select:'<div class="cform-select" data-name="{{name}}">    							<div class="cform-control">{{text}}</div>    							<ul></ul>    						</div>',multiselect:'<div class="cform-multiselect" data-name="{{name}}">    							<ul></ul>    						</div>',option:'<li data-value="{{value}}">{{text}}</li>',button:'<div class="cform-button"></div>',submit:'<div class="cform-submit"></div>'}},e.fn.cForm=function(a){return this.each(function(){new e.cForm(this,a)})}}(jQuery);